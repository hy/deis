#!/bin/bash

# write out chef configuration
sudo mkdir -p /etc/chef
sudo chown deis /etc/chef
echo $CHEF_CLIENT_KEY | base64 -d > /etc/chef/client.pem
echo $CHEF_VALIDATION_KEY | base64 -d > /etc/chef/validation.pem
cat > /etc/chef/client.rb <<EOF
log_level        :auto
log_location     STDOUT
chef_server_url  "$CHEF_SERVER_URL"
validation_client_name "$CHEF_VALIDATION_NAME"
node_name "$CHEF_NODE_NAME"
EOF
# if envvars are missing or empty, it should be caught by deis/settings.py

exec $@
